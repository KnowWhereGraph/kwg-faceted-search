<header>
    <div class="container home">
        <h1>Faceted Search: Discovery begins here.</h1>
    </div>

    <div class="search-bar-home">
        <form>
            <div class="form-group">
                <input ng-model="inputQuery" ng-change=onKeywordChange() class="form-control" placeholder="Search Places, Hazards, and Experts" />
                <button class="btn" type="submit" ng-click="keywordSubmit($event)">Search</button>
            </div>
        </form>
    </div>
</header>

<main id="home">
    <section class="alt about center">
        <div class="container">
            <h2>Welcome To KnowWhereGraph</h2>
            <p>With billions of data points at your fingertips, charting a path to a well-informed decision presents a navigational challenge. The Faceted Search Interface is a portal for exploring the KnowWhereGraph, a knowledge graph that integrates a
                wide range of environmental and human data. Whether supporting a humanitarian response following a hurricane or projecting supply-chain consequences of a wildfire, the Faceted Search Interface helps a user target and refine their investigation
                by exposing properties of the graph’s vast network of geographically referenced data.</p>
        </div>
        <a href="#/about" class="button secondary">Learn More</a>
    </section>
    <section class="explore center">
        <h2>Start Exploring</h2>
        <div class="container">
            <div class="popular-sub-topics">
                <div class="explore-title">
                </div>
                <div class="card-group-home columns-3">
                    <a href="#/result_search?tab=place">
                        <div class="card-explore">
                            <div class="card-body">
                                <p class="card-title">Place</p>
                            </div>
                        </div>
                    </a>

                    <a href="#/result_search?tab=hazard">
                        <div class="card-explore">
                            <div class="card-body">
                                <p class="card-title">Hazard</p>
                            </div>
                        </div>
                    </a>
                    <a href="#/result_search?tab=people">
                        <div class="card-explore">
                            <div class="card-body">
                                <p class="card-title">Expert</p>
                            </div>
                        </div>
                    </a>
                    <a href="#/result_search?tab=hazard&hazard=Wildfire">
                        <div class="card-explore">
                            <div class="card-body">
                                <p class="card-title">Wildfire</p>
                            </div>
                        </div>
                    </a>

                    <a href="#/result_search?tab=hazard&hazard=EarthquakeEvent">
                        <div class="card-explore">
                            <div class="card-body">
                                <p class="card-title">Earthquake</p>
                            </div>
                        </div>
                    </a>
                    <a href="#/result_search?tab=people&expert=hazardtopic.storm.aspecttopic.injury">
                        <div class="card-explore">
                            <div class="card-body">
                                <p class="card-title">Injury & Storms</p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>




        </div>
        <a href="#/explore" class="button secondary">Explore More</a>
    </section>
    <section class="home-map">
        <div class="map" id="home-map"></div>
    </section>

    <script>
        var homeMap = L.map('home-map').setView([51.505, -0.09], 13);

        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoidHJ1Y2hhbiIsImEiOiJjazZqaGJwdWwwYnJkM21vYnl1cDMwbGplIn0.--s7U90M9eJARzPGTGyQjg'
        }).addTo(homeMap);

        // add circle drawing

        if (homeMap) {
            homeMap.pm.addControls({
                position: "topleft",
                positions: {
                    draw: "topleft",
                    edit: "topleft"
                },
                drawMarker: false,
                drawCircleMarker: false,
                drawPolyline: false,
                drawRectangle: false,
                drawPolygon: false,
                drawCircle: true,

                drawControls: true,
                editControls: true,
                optionsControls: true,
                customControls: true,
                cutPolygon: false,
                rotateMode: false

            });

            homeMap.on("pm:create", (e) => {
                var coordinates;
                var radius;

                if (e.shape == "Polygon" || e.shape == "Rectangle") {
                    coordinates = homeMap.pm.getGeomanDrawLayers()[0].getLatLngs()[0];
                } else if (e.shape == "Circle") {
                    // the default circle to do spatial search is set to be the one just drawn
                    var spatialDrawLength = homeMap.pm.getGeomanDrawLayers().length;
                    coordinates = homeMap.pm.getGeomanDrawLayers()[spatialDrawLength - 1].getLatLng();
                    radius = homeMap.pm.getGeomanDrawLayers()[spatialDrawLength - 1].getRadius();
                    radius = radius / 1000; // convert to radius in kilometers

                    // create the circle object and convert its geometry to the wkt format
                    var optionsCircle = {
                        steps: 10,
                        units: 'kilometers',
                        properties: {
                            foo: 'bar'
                        }
                    };
                    var circle = turf.circle([coordinates.lng, coordinates.lat], radius, optionsCircle);
                    var circleWkt = '<http://www.opengis.net/def/crs/OGC/1.3/CRS84>POLYGON((';
                    var circleCoordinates = circle.geometry.coordinates[0];
                    for (i = 0; i < circleCoordinates.length; i++) {
                        circleWkt += circleCoordinates[i][0].toString() + ' ' + circleCoordinates[i][1].toString();
                        if (i == circleCoordinates.length - 1) {
                            circleWkt += '))';
                        } else {
                            circleWkt += ',';
                        }
                    }

                    // return the parameters for spatial search
                    // var parameters = getParameters();
                    // parameters["spatialSearchWkt"] = circleWkt;

                    // var tabName = (urlVariables['tab'] != null && urlVariables['tab'] != '') ? urlVariables['tab'] : 'place';
                    // var activeTabName = tabName.charAt(0).toUpperCase() + tab.slice(1);
                    // var pp = (urlVariables['pp'] != null && urlVariables['pp'] != '') ? parseInt(urlVariables['pp']) : 20;
                    // var page = (urlVariables['page'] != null && urlVariables['page'] != '') ? parseInt(urlVariables['page']) : 1;
                    // var response = sendQueries(activeTabName, page, pp, parameters);
                    // let queryIdentifier = uuidv4();
                    // currentQuery = queryIdentifier;
                    // prepareNewTable(activeTabName);
                    // response.then(function(result) {
                    //     var selectors = displayTableByTabName(activeTabName, result, "resultsSearchMap");
                    //     var countResults = result["count"];
                    //     displayPagination(activeTabName, selectors, countResults, parameters, "spatialSearchDraw");
                    // });
                    // $scope.updateURLParameters('polygon', 'circle');
                    // $scope.updateURLParameters('lon', coordinates.lng.toString());
                    // $scope.updateURLParameters('lat', coordinates.lat.toString());
                    // $scope.updateURLParameters('radius', radius.toString());
                }
            });
        };
    </script>
</main>